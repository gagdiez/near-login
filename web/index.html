<!DOCTYPE html>
<html>

<head>
  <link rel="icon" href="assets/favicon.ico" />
  <link rel="apple-touch-icon" href="assets/favicon.ico" />

  <title>Welcome</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <script src="http://code.jquery.com/jquery.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js"
    integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk"
    crossorigin="anonymous"></script>

  <!-- Near -->
  <script src="https://cdn.jsdelivr.net/gh/nearprotocol/near-api-js/dist/near-api-js.js"></script>

  <!-- Main JS -->
  <script type="module" src="./js/index.js"></script>

  <!-- Style -->
  <link rel="stylesheet" href="assets/global.css">
</head>

<body>
  <div class="container">

    <h1> Backend Sign-in Example </h1>

    <div class="row">
      <div class="col-5">

        <h4> Signing the Message </h4>
        <p>
          We ask the wallet to sign a message (see <i class="message">./public/js/index.js</i>).
          If the user accepts, the wallet returns the signed message alongside:
        <ul>
          <li>The account used to sign</li>
          <li>The public part of the <a href="https://docs.near.org/concepts/basics/accounts/access-keys">key</a> used
            to sign</li>
          <li>The block-id in which the message was signed</li>
        </ul>
        </p>

      </div>
      <div class="col-5">
        <h4> Authenticating the User </h4>
        <p>
          The signed message is sent to our express backend (see <i class="messages">./routes/user.js</i>), which then
          verifies that:
        </p>

        <ol>
          <li>The public key can decipher the message </li>
          <li>The public key belongs to the account</li>
          <li>The message was signed recently</li>
        </ol>

      </div>

    </div>

    <hr />

    <p class="text-center">
      {% if not user %}

      <!-- The server will serve this if the user is **NOT** authenticated -->
      You are not logged in. The backend won't allow you to access the <a href="/secret">secret page</a> until you
      <button class="btn btn-primary" id="login-btn"> Login using NEAR </button>
      
      {% else %}

      <!-- The server will serve this if the user **IS** authenticated -->
      Hi <b>{{user}}</b>, you can now check <a href="/secret"> the secret </a> -
      <button class="btn btn-primary" id="logout-btn"> Logout </button>

      {% endif %}
    </p>
  </div>
</body>
</html>